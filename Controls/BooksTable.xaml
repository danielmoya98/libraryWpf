<!-- Controls/BooksTable.xaml -->
<UserControl x:Class="library.Controls.BooksTable"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:converters="clr-namespace:library.Converters"
             xmlns:behaviors="clr-namespace:library.Behaviors">

    <!-- Recursos -->
    <UserControl.Resources>
        <ResourceDictionary>
            <!-- Reusa los estilos del CustomersTable -->
            <ResourceDictionary.MergedDictionaries>
                <!-- Ajusta la ruta si tu Styles.xaml está en otra ubicación -->
                <ResourceDictionary Source="../Resources/Themes/CustomersTable.Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Converter para cargar imágenes de forma segura -->
            <converters:SafeImageSourceConverter x:Key="SafeImg" />
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- TABLA -->
        <DataGrid Grid.Row="0"
                  ItemsSource="{Binding BooksView}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserReorderColumns="False"
                  CanUserResizeColumns="False"
                  CanUserDeleteRows="False"
                  HeadersVisibility="Column"
                  RowHeaderWidth="0"
                  SelectionUnit="FullRow"
                  ColumnHeaderStyle="{StaticResource SlimHeader}"
                  RowStyle="{StaticResource SlimRow}"
                  CellStyle="{StaticResource CenterCell}"
                  HorizontalGridLinesBrush="{StaticResource RowSeparator}"
                  materialDesign:DataGridAssist.CellPadding="12,8"
                  materialDesign:DataGridAssist.ColumnHeaderPadding="12,10"
                  IsReadOnly="True"
                  behaviors:AdaptiveColumnsBehavior.Breakpoints="
                    1150:Stock;
                    1100:Year;
                    1020:Category;
                    940:ISBN;
                    860:Author;">

            <DataGrid.Columns>

                <!-- Portada -->
                <DataGridTemplateColumn Header="PORTADA" Width="70" CanUserSort="False"
                                        behaviors:AdaptiveColumnsBehavior.Key="Cover">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid Width="40" Height="54" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Border Margin="5" CornerRadius="4" Background="#EEF2F7" BorderBrush="#E2E8F0"
                                        BorderThickness="1" />
                                <Border CornerRadius="4">
                                    <Border.Background>
                                        <ImageBrush Stretch="UniformToFill"
                                                    ImageSource="{Binding CoverPath, Converter={StaticResource SafeImg}}" />
                                    </Border.Background>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="TÍTULO"
                                    SortMemberPath="Title"
                                    behaviors:AdaptiveColumnsBehavior.Key="Title"
                                    Binding="{Binding Title}"
                                    ElementStyle="{StaticResource CellTextCenter}" Width="2*" />

                <DataGridTextColumn Header="AUTOR"
                                    SortMemberPath="Author"
                                    behaviors:AdaptiveColumnsBehavior.Key="Author"
                                    Binding="{Binding Author}"
                                    ElementStyle="{StaticResource CellTextCenter}" Width="2*" />

                <DataGridTextColumn Header="ISBN"
                                    SortMemberPath="ISBN"
                                    behaviors:AdaptiveColumnsBehavior.Key="ISBN"
                                    Binding="{Binding ISBN}"
                                    ElementStyle="{StaticResource CellTextCenter}" Width="*" />

                <DataGridTextColumn Header="CATEGORÍA"
                                    SortMemberPath="Category"
                                    behaviors:AdaptiveColumnsBehavior.Key="Category"
                                    Binding="{Binding Category}"
                                    ElementStyle="{StaticResource CellTextCenter}" Width="*" />

                <DataGridTextColumn Header="AÑO"
                                    SortMemberPath="Year"
                                    behaviors:AdaptiveColumnsBehavior.Key="Year"
                                    Binding="{Binding Year}"
                                    ElementStyle="{StaticResource CellTextCenter}" Width="*" />

                <DataGridTextColumn Header="STOCK"
                                    SortMemberPath="Stock"
                                    behaviors:AdaptiveColumnsBehavior.Key="Stock"
                                    Binding="{Binding Stock}"
                                    ElementStyle="{StaticResource CellTextCenter}" Width="*" />

                <!-- Acción -->
                <DataGridTemplateColumn Header="ACCIÓN" Width="120" CanUserSort="False"
                                        behaviors:AdaptiveColumnsBehavior.Key="Action">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Style="{StaticResource GhostIconButton}" ToolTip="Editar"
                                        Command="{Binding DataContext.EditBookCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}">
                                    <mah:PackIconMaterial Kind="SquareEditOutline" Width="18" Height="18"
                                                          Foreground="#6B7280" />
                                </Button>
                                <Button Style="{StaticResource GhostIconButton}" ToolTip="Eliminar"
                                        Command="{Binding DataContext.DeleteBookCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}">
                                    <mah:PackIconMaterial Kind="TrashCanOutline" Width="18" Height="18"
                                                          Foreground="#6B7280" />
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

            </DataGrid.Columns>
        </DataGrid>

    </Grid>
</UserControl>