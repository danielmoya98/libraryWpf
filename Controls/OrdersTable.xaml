<UserControl x:Class="library.Controls.OrdersTable"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:behaviors="clr-namespace:library.Behaviors">

  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="../Resources/Themes/CustomersTable.Styles.xaml"/>
      </ResourceDictionary.MergedDictionaries>

      <!-- Chip de estado -->
      <Style x:Key="StatusChip" TargetType="Border">
        <Setter Property="Padding" Value="10,4"/>
        <Setter Property="CornerRadius" Value="10"/>
        <Setter Property="Background" Value="#EEF2F6"/>
        <Setter Property="BorderBrush" Value="#E2E8F0"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="TextElement.Foreground" Value="#475569"/>
        <Style.Triggers>
          <DataTrigger Binding="{Binding Status}" Value="Pending">
            <Setter Property="Background" Value="#FFF7E6"/>
            <Setter Property="BorderBrush" Value="#FFE8C7"/>
            <Setter Property="TextElement.Foreground" Value="#B45309"/>
          </DataTrigger>
          <DataTrigger Binding="{Binding Status}" Value="Active">
            <Setter Property="Background" Value="#E6F4FF"/>
            <Setter Property="BorderBrush" Value="#CFE8FF"/>
            <Setter Property="TextElement.Foreground" Value="#1D4ED8"/>
          </DataTrigger>
          <DataTrigger Binding="{Binding Status}" Value="Returned">
            <Setter Property="Background" Value="#EAF7EF"/>
            <Setter Property="BorderBrush" Value="#D2EFE0"/>
            <Setter Property="TextElement.Foreground" Value="#047857"/>
          </DataTrigger>
          <DataTrigger Binding="{Binding Status}" Value="Overdue">
            <Setter Property="Background" Value="#FEE2E2"/>
            <Setter Property="BorderBrush" Value="#FECACA"/>
            <Setter Property="TextElement.Foreground" Value="#B91C1C"/>
          </DataTrigger>
        </Style.Triggers>
      </Style>
    </ResourceDictionary>
  </UserControl.Resources>

  <Grid>
    <DataGrid x:Name="GridOrders"
              ItemsSource="{Binding OrdersView}"
              AutoGenerateColumns="False"
              CanUserAddRows="False" CanUserReorderColumns="False"
              CanUserResizeColumns="False" CanUserDeleteRows="False"
              HeadersVisibility="Column" RowHeaderWidth="0"
              SelectionUnit="FullRow"
              ColumnHeaderStyle="{StaticResource SlimHeader}"
              RowStyle="{StaticResource SlimRow}"
              CellStyle="{StaticResource CenterCell}"
              HorizontalGridLinesBrush="{StaticResource RowSeparator}"
              materialDesign:DataGridAssist.CellPadding="12,8"
              materialDesign:DataGridAssist.ColumnHeaderPadding="12,10"
              IsReadOnly="True"
              VerticalAlignment="Stretch"
              HorizontalAlignment="Stretch"
              ScrollViewer.VerticalScrollBarVisibility="Auto"
              behaviors:AdaptiveColumnsBehavior.Breakpoints="
                    1200:Fine;
                    1100:MemberName;
                    1000:Code;
                     900:BookTitle;
                     820:StartDate">

      <DataGrid.Columns>
        <DataGridTextColumn Header="CÓDIGO" SortMemberPath="Code"
                            behaviors:AdaptiveColumnsBehavior.Key="Code"
                            Binding="{Binding Code}" Width="*"
                            ElementStyle="{StaticResource CellTextCenter}"/>

        <DataGridTextColumn Header="MIEMBRO" SortMemberPath="MemberName"
                            behaviors:AdaptiveColumnsBehavior.Key="MemberName"
                            Binding="{Binding MemberName}" Width="2*"
                            ElementStyle="{StaticResource CellTextCenter}"/>

        <DataGridTextColumn Header="LIBRO" SortMemberPath="BookTitle"
                            behaviors:AdaptiveColumnsBehavior.Key="BookTitle"
                            Binding="{Binding BookTitle}" Width="2*"
                            ElementStyle="{StaticResource CellTextCenter}"/>

        <DataGridTextColumn Header="FECHA RESERVA" SortMemberPath="StartDate"
                            behaviors:AdaptiveColumnsBehavior.Key="StartDate"
                            Binding="{Binding StartDate, StringFormat=\{0:dd/MM/yyyy\}}" Width="*"
                            ElementStyle="{StaticResource CellTextCenter}"/>

        <DataGridTextColumn Header="FECHA LÍMITE" SortMemberPath="DueDate"
                            behaviors:AdaptiveColumnsBehavior.Key="DueDate"
                            Binding="{Binding DueDate, StringFormat=\{0:dd/MM/yyyy\}}" Width="*"
                            ElementStyle="{StaticResource CellTextCenter}"/>

        <DataGridTemplateColumn Header="ESTADO" SortMemberPath="Status" Width="*"
                                behaviors:AdaptiveColumnsBehavior.Key="Status">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <Border Style="{StaticResource StatusChip}" HorizontalAlignment="Center">
                <StackPanel Orientation="Horizontal">
                  <Ellipse Width="8" Height="8" Fill="#64748B" Margin="0,0,6,0"/>
                  <TextBlock Text="{Binding Status}" FontWeight="SemiBold"/>
                </StackPanel>
              </Border>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

        <DataGridTextColumn Header="MULTA" SortMemberPath="Fine"
                            behaviors:AdaptiveColumnsBehavior.Key="Fine"
                            Binding="{Binding Fine, StringFormat=\{0:C\}}" Width="*"
                            ElementStyle="{StaticResource CellTextCenter}"/>

        <!-- ACCIONES: Realizar préstamo / Cancelar reserva -->
        <DataGridTemplateColumn Header="ACCIÓN" Width="180" CanUserSort="False"
                                behaviors:AdaptiveColumnsBehavior.Key="Action">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" >
                <!-- Realizar préstamo -->
                <Button Style="{StaticResource GhostIconButton}"
                        ToolTip="Realizar préstamo"
                        Command="{Binding DataContext.StartLoanCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        CommandParameter="{Binding}">
                  <mah:PackIconMaterial Kind="BookCheckOutline" Width="18" Height="18" Foreground="#6B7280"/>
                </Button>

                <!-- Cancelar reserva -->
                <Button Style="{StaticResource GhostIconButton}" Margin="6,0,0,0"
                        ToolTip="Cancelar reserva"
                        Command="{Binding DataContext.CancelReservationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        CommandParameter="{Binding}">
                  <mah:PackIconMaterial Kind="CloseCircleOutline" Width="18" Height="18" Foreground="#6B7280"/>
                </Button>
              </StackPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
    </DataGrid>
  </Grid>
</UserControl>
