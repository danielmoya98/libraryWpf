<UserControl x:Class="library.Dialogs.EditBookDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:converters="clr-namespace:library.Converters"
             MinWidth="560" MaxWidth="720" MaxHeight="525">

  <!-- Recursos -->
  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="../Resources/Themes/CustomersTable.Styles.xaml"/>
      </ResourceDictionary.MergedDictionaries>
      <converters:SafeImageSourceConverter x:Key="SafeImg"/>
    </ResourceDictionary>
  </UserControl.Resources>

  <Border Padding="24" Background="White">
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>

      <!-- Título -->
      <TextBlock Grid.Row="0"
                 Text="Editar libro"
                 FontSize="20" FontWeight="SemiBold" Foreground="#243147"
                 Margin="0,0,0,16"/>

      <!-- Cuerpo -->
      <Grid Grid.Row="1">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="360"/>
          <ColumnDefinition Width="28"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Columna izquierda: portada -->
        <Grid Grid.Column="0">
          <Ellipse Fill="#0F000000" Width="220" Height="220"
                   HorizontalAlignment="Center" VerticalAlignment="Top"
                   Margin="0,12,0,0"/>
          <Border Width="240" Height="340"
                  HorizontalAlignment="Center" VerticalAlignment="Center"
                  CornerRadius="8" BorderBrush="#E2E8F0" BorderThickness="1"
                  Background="#F6F8FB">
            
          </Border>

          <!-- URL de imagen (sincroniza preview) -->
          <StackPanel Margin="0,12,0,0" VerticalAlignment="Bottom">
            <TextBox materialDesign:HintAssist.Hint="URL de la portada"
                     Text="{Binding CoverUrl, UpdateSourceTrigger=PropertyChanged}"
                     Margin="0,6,0,0"/>
          </StackPanel>
        </Grid>

        <!-- Separador -->
        <Rectangle Grid.Column="1" Width="1" Fill="#EDF1F7" HorizontalAlignment="Center"/>

        <!-- Columna derecha: formulario -->
        <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Fila 0: Título + Género -->
            <TextBox Grid.Row="0" Grid.Column="0" Margin="0,0,8,10"
                     materialDesign:HintAssist.Hint="Título"
                     Text="{Binding Title}"/>
            <ComboBox Grid.Row="0" Grid.Column="1" Margin="8,0,0,10"
                      ItemsSource="{Binding GenreItems}"
                      SelectedValuePath="Key" DisplayMemberPath="Value"
                      SelectedValue="{Binding SelectedGenre, Mode=TwoWay}"
                      materialDesign:HintAssist.Hint="Género"/>

            <!-- Fila 1: Autor + Nuevo / Estado -->
            <Grid Grid.Row="1" Grid.Column="0" Margin="0,0,8,10">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>
              <TextBox Grid.Column="0" materialDesign:HintAssist.Hint="Autor(es)"
                       Text="{Binding Author}"/>
              
            </Grid>

            <ComboBox Grid.Row="1" Grid.Column="1" Margin="8,0,0,10"
                      ItemsSource="{Binding ConditionItems}"
                      SelectedValuePath="Key" DisplayMemberPath="Value"
                      SelectedValue="{Binding ConditionKey, Mode=TwoWay}"
                      materialDesign:HintAssist.Hint="Estado"/>

            <!-- Fila 2: Editorial + ISBN -->
            <TextBox Grid.Row="2" Grid.Column="0" Margin="0,0,8,10"
                     materialDesign:HintAssist.Hint="Editorial"
                     Text="{Binding Publisher}"/>
            <TextBox Grid.Row="2" Grid.Column="1" Margin="8,0,0,10"
                     materialDesign:HintAssist.Hint="ISBN"
                     Text="{Binding Isbn}"/>

            <!-- Fila 3: Año + Stock -->
            <TextBox Grid.Row="3" Grid.Column="0" Margin="0,0,8,10"
                     materialDesign:HintAssist.Hint="Año"
                     Text="{Binding Year}"/>
            <TextBox Grid.Row="3" Grid.Column="1" Margin="8,0,0,10"
                     materialDesign:HintAssist.Hint="Cantidad (stock)"
                     Text="{Binding Stock}"/>

            <!-- Fila 4: Calificación + Disponible -->
            <TextBox Grid.Row="4" Grid.Column="0" Margin="0,0,8,10"
                     materialDesign:HintAssist.Hint="Calificación"
                     Text="{Binding Rating}"/>
            <StackPanel Grid.Row="4" Grid.Column="1" Orientation="Horizontal"
                        Margin="8,6,0,10">
              <CheckBox IsChecked="{Binding Available}" VerticalAlignment="Center" Margin="0,0,6,0"/>
              <TextBlock Text="Disponible" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Fila 5-6: Sinopsis -->
            <TextBox Grid.Row="6" Grid.ColumnSpan="2" Height="150"
                     AcceptsReturn="True" TextWrapping="Wrap"
                     materialDesign:HintAssist.Hint="Sinopsis"
                     Text="{Binding Synopsis}"/>
          </Grid>
        </ScrollViewer>
      </Grid>

      <!-- Footer -->
      <DockPanel Grid.Row="2" LastChildFill="False" Margin="0,18,0,0">
        <!-- Cancelar -->
        <Button DockPanel.Dock="Right" Margin="8,0,0,0"
                Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}"
                CommandParameter="{x:Null}">
          <StackPanel Orientation="Horizontal">
            <mah:PackIconMaterial Kind="Close" Width="18" Height="18" Margin="0,0,8,0"/>
            <TextBlock Text="Cancelar"/>
          </StackPanel>
        </Button>

        <!-- Guardar cambios -->
        <Button DockPanel.Dock="Right"
                IsEnabled="{Binding IsValid}"
                Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}"
                CommandParameter="{Binding}">
          <StackPanel Orientation="Horizontal">
            <mah:PackIconMaterial Kind="ContentSaveOutline" Width="18" Height="18" Margin="0,0,8,0"/>
            <TextBlock Text="Guardar cambios"/>
          </StackPanel>
        </Button>
      </DockPanel>
    </Grid>
  </Border>
</UserControl>
